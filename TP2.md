I
-


Compte-rendu
‚òÄÔ∏è Sur node1.lan1.tp2

afficher ses cartes r√©seau :

```
[bossautruche@node1 ~]$ ip a
1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
    inet 127.0.0.1/8 scope host lo
       valid_lft forever preferred_lft forever
    inet6 ::1/128 scope host
       valid_lft forever preferred_lft forever
2: enp0s8: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc fq_codel state UP group default qlen 1000
    link/ether 08:00:27:af:5b:97 brd ff:ff:ff:ff:ff:ff
    inet 10.1.1.11/24 brd 10.1.1.255 scope global noprefixroute enp0s8
       valid_lft forever preferred_lft forever
    inet6 fe80::a00:27ff:feaf:5b97/64 scope link
       valid_lft forever preferred_lft forever
 ```

afficher sa table de routage:
```
ip n s
10.1.1.1 dev enp0s8 lladdr 0a:00:27:00:00:06 DELAY
10.1.1.12 dev enp0s8 lladdr 08:00:27:a2:51:3c STALE
10.1.1.254 dev enp0s8 lladdr 08:00:27:25:26:1b STALE
```


prouvez qu'il peut joindre node2.lan2.tp2 :
```
[bossautruche@node1 ~]$ ping 10.1.2.12
PING 10.1.2.12 (10.1.2.12) 56(84) bytes of data.
64 bytes from 10.1.2.12: icmp_seq=1 ttl=63 time=0.905 ms
64 bytes from 10.1.2.12: icmp_seq=2 ttl=63 time=2.79 ms
64 bytes from 10.1.2.12: icmp_seq=3 ttl=63 time=3.27 ms
```

prouvez avec un traceroute que le paquet passe bien par router.tp2 :

```
[bossautruche@node1 ~]$ traceroute 10.1.2.12
traceroute to 10.1.2.12 (10.1.2.12), 30 hops max, 60 byte packets
 1  10.1.1.254 (10.1.1.254)  11.460 ms  0.332 ms  0.268 ms
 2  10.1.2.12 (10.1.2.12)  1.078 ms !X  0.954 ms !X  0.925 ms !X
```
------

II
--

‚òÄÔ∏èSur router.tp2


prouvez que vous avez un acc√®s internet (ping d'une IP publique) :

```
[bossautruche@localhost ~]$ ping 8.8.8.8
PING 8.8.8.8 (8.8.8.8) 56(84) bytes of data.
64 bytes from 8.8.8.8: icmp_seq=1 ttl=114 time=16.6 ms
64 bytes from 8.8.8.8: icmp_seq=2 ttl=114 time=18.9 ms
64 bytes from 8.8.8.8: icmp_seq=3 ttl=114 time=20.4 ms
64 bytes from 8.8.8.8: icmp_seq=4 ttl=114 time=19.1 ms
^C
--- 8.8.8.8 ping statistics ---
4 packets transmitted, 4 received, 0% packet loss, time 3006ms
rtt min/avg/max/mdev = 16.591/18.761/20.368/1.366 ms
```


prouvez que vous pouvez r√©soudre des noms publics (ping d'un nom de domaine public):

```
[bossautruche@localhost ~]$ ping google.com
PING google.com (172.217.18.206) 56(84) bytes of data.
64 bytes from par10s38-in-f14.1e100.net (172.217.18.206): icmp_seq=1 ttl=116 time=17.4 ms
64 bytes from par10s38-in-f14.1e100.net (172.217.18.206): icmp_seq=2 ttl=116 time=22.8 ms
^C
--- google.com ping statistics ---
2 packets transmitted, 2 received, 0% packet loss, time 1002ms
rtt min/avg/max/mdev = 17.416/20.120/22.825/2.704 ms
```


‚òÄÔ∏è Acc√®s internet LAN1 et LAN2

ajoutez une route par d√©faut sur les deux machines du LAN1:
```
 sudo ip route add default via 10.1.1.254 dev enp0s8 
```


ajoutez une route par d√©faut sur les deux machines du LAN2:

```
[bossautruche@node2 ~]$  sudo ip route add default via 10.1.2.254 dev enp0s8
```


configurez l'adresse d'un serveur DNS que vos machines peuvent utiliser pour r√©soudre des noms
dans le compte-rendu, mettez-moi que la conf des points pr√©c√©dents sur node2.lan1.tp2 :

```
[bossautruche@node2 ~]$ sudo cat /etc/resolv.conf
# Generated by NetworkManager
search lan1.tp2
nameserver 1.1.1.1
```

prouvez que node2.lan1.tp2 a un acc√®s internet :

il peut ping une IP publique :

```
[bossautruche@node2 ~]$ ping 8.8.8.8
PING 8.8.8.8 (8.8.8.8) 56(84) bytes of data.
64 bytes from 8.8.8.8: icmp_seq=1 ttl=113 time=19.6 ms
64 bytes from 8.8.8.8: icmp_seq=2 ttl=113 time=19.6 ms
```

il peut ping un nom de domaine public :
```
[bossautruche@node2 ~]$ ping google.com
PING google.com (216.58.214.174) 56(84) bytes of data.
64 bytes from mad01s26-in-f174.1e100.net (216.58.214.174): icmp_seq=1 ttl=114 time=24.9 ms
```
----------

III
--

‚òÄÔ∏è Sur dhcp.lan1.tp2

n'oubliez pas de renommer la machine (node2.lan1.tp2 devient dhcp.lan1.tp2) :

```
[bossautruche@node2 ~]$ hostname
dhcp.lan1.tp2
```

changez son adresse IP en 10.1.1.253 :
```
[bossautruche@node2 ~]$ cat /etc/sysconfig/network-scripts/ifcfg-enp0s8
NAME=enp0s8
DEVICE=enp0s8

BOOTPROTO=static
ONBOOT=yes

IPADDR=10.1.1.253
NETMASK=255.255.255.0
```


setup du serveur DHCP

commande d'installation du paquet:
```
[bossautruche@node2 ~]$ sudo dnf install dhcp-server
```
fichier de conf :
```
[bossautruche@node2 ~]$ sudo cat /etc/dhcp/dhcpd.conf
#
# DHCP Server Configuration file.
#   see /usr/share/doc/dhcp-server/dhcpd.conf.example
#   see dhcpd.conf(5) man page
#
# create new
# specify domain name
option domain-name "Meow-Internet";

#specify DNS server's hostname or IP address
option domain-name-servers 1.1.1.1;

#default lease time
default-lease-time 600;

#max lease time
max-lease-time 7200;

# this DHCP server to be declared valid
authoritative;

#specify network address and subnetmask
subnet 10.1.1.0 netmask 255.255.255.0 {
        #specify range of lease IP address
        range dynamic-bootp 10.1.1.100 10.1.1.200;
        #specify broadcast address
        option broadcast-address 10.1.1.255;
        #specify gateway
        option routers 10.1.1.254;
}
```

service actif :

il est pas actif lol je galere

OH BORDEL il manquait une acollade dans le fichier dhcp, j'aurais du ouvrir les logs direct, maintenant c'est la premiere chose a laquelle je vais penser.

```
[bossautruche@dhcp ~]$ systemctl status dhcpd
‚óè dhcpd.service - DHCPv4 Server Daemon
     Loaded: loaded (/usr/lib/systemd/system/dhcpd.service; enabled; preset: disabled)
     Active: active (running) since Thu 2023-10-26 23:00:12 CEST; 29min ago
```



‚òÄÔ∏è Sur node1.lan1.tp2

demandez une IP au serveur DHCP :

je modifie le fichier : 
```
[bossautruche@node1 ~]$ sudo nano /etc/sysconfig/network-scripts/ifcfg-enp0s8
```
```
NAME=enp0s8
DEVICE=enp0s8

BOOTPROTO=dhcp
ONBOOT=yes
```

prouvez que vous avez bien r√©cup√©r√© une IP via le DHCP :

DORA
```
Oct 26 23:03:36 dhcp.lan1.tp2 dhcpd[1313]: DHCPDISCOVER from 08:00:27:af:5b:97 via enp0s8
Oct 26 23:03:37 dhcp.lan1.tp2 dhcpd[1313]: DHCPOFFER on 10.1.1.100 to 08:00:27:af:5b:97 (node1) via enp0s8
Oct 26 23:03:37 dhcp.lan1.tp2 dhcpd[1313]: DHCPREQUEST for 10.1.1.100 (10.1.1.253) from 08:00:27:af:5b:97 (node1) via enp0s8
Oct 26 23:03:37 dhcp.lan1.tp2 dhcpd[1313]: DHCPACK on 10.1.1.100 to 08:00:27:af:5b:97 (node1) via enp0s8
```

prouvez que vous avez bien r√©cup√©r√© l'IP de la passerelle :
```
[bossautruche@node1 ~]$ ping google.com
PING google.com (216.58.214.174) 56(84) bytes of data.
64 bytes from mad01s26-in-f174.1e100.net (216.58.214.174): icmp_seq=1 ttl=112 time=28.1 ms
```

prouvez que vous pouvez ping node1.lan2.tp2 :

```
[bossautruche@node1 ~]$ ping 10.1.2.11
PING 10.1.2.11 (10.1.2.11) 56(84) bytes of data.
64 bytes from 10.1.2.11: icmp_seq=1 ttl=63 time=1.30 ms
```
-----

 Web web web
 --
Un petit serveur web ? Pour la route ?
On recycle ici, toujours dans un soucis d'√©conomie de ressources, la machine node2.lan2.tp2 qui devient web.lan2.tp2 :

 On va y monter un serveur Web qui mettra √† disposition un site web tout nul.

La conf du serveur web :

ce sera notre vieil ami NGINX
il √©coutera sur le port 80, port standard pour du trafic HTTP
la racine web doit se trouver dans /var/www/site_nul/

vous y cr√©erez un fichier /var/www/site_nul/index.html avec le contenu de votre choix


vous ajouterez dans la conf NGINX un fichier d√©di√© pour servir le site web nul qui se trouve dans /var/www/site_nul/

√©coute sur le port 80
r√©pond au nom site_nul.tp2

sert le dossier /var/www/site_nul/



n'oubliez pas d'ouvrir le port dans le firewall üåº



‚òÄÔ∏è Sur web.lan2.tp2

n'oubliez pas de renommer la machine (node2.lan2.tp2 devient web.lan2.tp2) :
```
[bossautruche@node2 ~]$ hostname
web.lan2.tp2
```

setup du service Web

installation de NGINX :
```
sudo yum install nginx
```

gestion de la racine web /var/www/site_nul/ :

petit sudo mkdir -p pour que ca creer tout si c'est pas deja le cas
```
sudo mkdir -p /var/www/site2primate/
```

service actif :
```
[bossautruche@node2 ~]$ sudo systemctl status nginx
‚óè nginx.service - The nginx HTTP and reverse proxy server
     Loaded: loaded (/usr/lib/systemd/system/nginx.service; enabled; preset: disabled)
     Active: active (running) since Fri 2023-10-27 00:02:50 CEST; 8min ago
    Process: 1491 ExecStartPre=/usr/bin/rm -f /run/nginx.pid (code=exited, status=0/SUCCESS)
    Process: 1492 ExecStartPre=/usr/sbin/nginx -t (code=exited, status=0/SUCCESS)
    Process: 1493 ExecStart=/usr/sbin/nginx (code=exited, status=0/SUCCESS)
   Main PID: 1494 (nginx)
      Tasks: 2 (limit: 11052)
     Memory: 2.0M
        CPU: 32ms
     CGroup: /system.slice/nginx.service
```


prouvez qu'il y a un programme NGINX qui tourne derri√®re le port 80 de la machine (commande ss)
prouvez que le firewall est bien configur√©

‚òÄÔ∏è Sur node1.lan1.tp2

√©ditez le fichier hosts pour que site_nul.tp2 pointe vers l'IP de web.lan2.tp2 :
```
[bossautruche@node1 /]$ ping site2primate.tp2
PING site2primate.tp2 (10.1.2.12) 56(84) bytes of data.
64 bytes from site2primate.tp2 (10.1.2.12): icmp_seq=1 ttl=63 time=0.884 ms
```

visitez le site nul avec une commande curl et en utilisant le nom site_nul.tp2 :

------
resum√© :
--
  *il est super tard, donc je laisse pour ajd c'etait un tp super interessant on a repris vraiment les bases de pleins de trucs qu'on avait fait l'ann√©e derniere. d'ailleurs je suis surpris de moi meme je trouve que je me suis pas trop mal debrouill√© alors que je n'ai pas touche au reseau pendant tout l'√©t√© (j'ai suivi ton conseil) comme quoi le cerveau restitue tout seul quand on lui laisse le temps*

  *il y'a 300 jours je ne savais pas ce qu'etait une adresse ip*

  











